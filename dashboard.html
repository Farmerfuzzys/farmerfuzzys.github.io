<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:Arial;
}
.card {
  background:#1c1c1c;
  padding:20px;
  margin:20px 0;
  border-radius:10px;
}
input, button {
  width:100%;
  padding:10px;
  margin:5px 0;
  background:#2a2a2a;
  color:#fff;
  border:none;
  border-radius:6px;
}
button { cursor:pointer; }
.admin { border:1px solid #ff6a00; }
</style>
</head>

<body>

<h1>Dashboard</h1>
<div id="userInfo"></div>

<div id="adminPanel" style="display:none">
  <div class="card admin">
    <h2>Admin Panel</h2>

    <input id="newUser" placeholder="Benutzername">
    <input id="newPass" placeholder="Passwort">
    <select id="newRole">
      <option value="user">User</option>
      <option value="admin">Admin</option>
    </select>
    <button onclick="createUser()">User erstellen</button>
  </div>
</div>

<button onclick="logout()">Logout</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, createUserWithEmailAndPassword } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "DEIN_API_KEY",
  authDomain: "DEIN_PROJEKT.firebaseapp.com",
  projectId: "DEIN_PROJEKT"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

function toEmail(username){
  return username.toLowerCase() + "@farmerfuzzys.local";
}

onAuthStateChanged(auth, async user => {
  if (!user) {
    location.href = "index.html";
    return;
  }

  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    document.body.innerHTML = "Kein Benutzerprofil";
    return;
  }

  const data = snap.data();
  userInfo.innerHTML = `
    <p>Benutzer: <b>${data.username}</b></p>
    <p>Rolle: <b>${data.role}</b></p>
  `;

  if (data.role === "admin") {
    adminPanel.style.display = "block";
  }
});

window.createUser = async () => {
  const username = newUser.value;
  const password = newPass.value;
  const role = newRole.value;

  if (!username || !password) {
    alert("Fehlende Daten");
    return;
  }

  try {
    const cred = await createUserWithEmailAndPassword(
      auth,
      toEmail(username),
      password
    );

    await setDoc(doc(db, "users", cred.user.uid), {
      username,
      role
    });

    alert("User erstellt");
    newUser.value = "";
    newPass.value = "";

  } catch (e) {
    alert("Fehler: " + e.message);
  }
};

window.logout = async () => {
  await signOut(auth);
  location.href = "index.html";
};
</script>

</body>
</html>
