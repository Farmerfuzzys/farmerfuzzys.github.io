<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | FarmerFuzzys</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="login-container">
        <div class="login-card">
            <img src="Farmerfuzzys_logo.jpg" alt="Logo" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 20px; border: 2px solid var(--accent);">
            <h1 style="margin-bottom: 10px;">Anmelden</h1>
            <p style="color: var(--text-muted); margin-bottom: 25px; font-size: 0.9rem;">Bitte gib deine Zugangsdaten ein</p>
            
            <div style="text-align: left;">
                <label style="font-size: 0.8rem; color: var(--accent); margin-left: 5px;">Benutzername</label>
                <input id="user" type="text" placeholder="z.B. Scheemie" autocomplete="username">
                
                <label style="font-size: 0.8rem; color: var(--accent); margin-left: 5px;">Passwort</label>
                <input id="pass" type="password" placeholder="••••••••" autocomplete="current-password">
            </div>

            <button onclick="login()" class="btn-primary" style="margin-top: 15px;">Login</button>
            
            <div id="loginError" style="color: var(--danger); margin-top: 15px; font-size: 0.85rem; display: none;">
                Login fehlgeschlagen. Bitte Daten prüfen.
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDiYOJWP4XMQRJ6b-RfJp6Aqxis7E-uA30",
            authDomain: "farmerfuzzys-c32eb.firebaseapp.com",
            projectId: "farmerfuzzys-c32eb",
            storageBucket: "farmerfuzzys-c32eb.firebasestorage.app",
            messagingSenderId: "842395157432",
            appId: "1:842395157432:web:fd031d7cc0c2a6e69ec54d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // LOGIN FUNKTION
        window.login = async () => {
            const userField = document.getElementById('user').value.toLowerCase().trim();
            const passField = document.getElementById('pass').value;
            const errorDiv = document.getElementById('loginError');

            if(!userField || !passField) {
                alert("Bitte alle Felder ausfüllen!");
                return;
            }

            // Wir hängen die interne Domain an, damit Firebase eine E-Mail hat
            const email = userField + "@farmerfuzzys.local";

            try {
                await signInWithEmailAndPassword(auth, email, passField);
                // Bei Erfolg: Sofort zum Dashboard
                window.location.replace("dashboard.html");
            } catch (e) {
                console.error("Login Fehler:", e.code);
                errorDiv.style.display = "block";
                errorDiv.innerText = "Fehler: " + e.message;
            }
        };

        // Falls der User bereits eingeloggt ist, kann er zum Dashboard (optional)
        // Aber wir machen hier KEINEN automatischen Redirect ohne Klick, 
        // um die Endlos-Schleife zu vermeiden.
    </script>
</body>
</html>
